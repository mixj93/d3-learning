<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://d3js.org/d3.v6.js"></script>
    <title>力学图的制作</title>
    <style></style>
  </head>
  <body>
    <!-- https://blog.csdn.net/lzhlzz/article/details/38061955 -->

    <script>
      var width = 600
      var height = 600

      var nodes = [
        { name: 'GuiLin' },
        { name: 'GuangZhou' },
        { name: 'XiaMen' },
        { name: 'HangZhou' },
        { name: 'ShangHai' },
        { name: 'QingDao' },
        { name: 'TianJin' },
        { name: 'BeiJing' },
        { name: 'ChangChun' },
        { name: 'XiAn' },
        { name: 'WuluMuQi' },
        { name: 'LaSa' },
        { name: 'ChengDu' },
      ]

      var edges = [
        { source: 0, target: 1 },
        { source: 1, target: 2 },
        { source: 2, target: 3 },
        { source: 3, target: 4 },
        { source: 4, target: 5 },
        { source: 5, target: 6 },
        { source: 6, target: 7 },
        { source: 7, target: 8 },
        { source: 8, target: 9 },
        { source: 9, target: 10 },
        { source: 10, target: 11 },
        { source: 11, target: 12 },
        { source: 12, target: 0 },
      ]

      // 这里有顶点（ nodes ）和边（ edges ），这里的顶点是一些城市名称，边是两个顶点之间的连线。
      // 我们现在要用这些数据来做力学图。但是这样的数据不适合做力学图，比如不知道每一个顶点画在哪个坐标等。
      // 所以需要先用 Layout 来转换数据，我们说过， D3 中的 Layout 就是用来转换数据的。

      const simulation = d3
        .forceSimulation()
        .nodes(nodes)
        .force('charge', () => [-100])
        .force('link', d3.forceLink(edges))
        .force('distance', () => 200)
        .on('tick', () => null)
      // .forceLink(edges)
      // .size([width, height])
      // .linkDistance(200)
      // .charge([-100])

      var svg_edges = simulation
        .selectAll('line')
        .data(edges)
        .enter()
        .append('line')
        .style('stroke', '#ccc')
        .style('stroke-width', 1)

      var color = d3.scale.category20()

      var svg_nodes = simulation
        .selectAll('circle')
        .data(nodes)
        .enter()
        .append('circle')
        .attr('r', 10)
        .style('fill', function (d, i) {
          return color(i)
        })
        .call(force.drag)
      // 这样的代码我们已经很熟悉了，只有最后一句代码没出现过， call( force.drag ) 是设定我们可以拖动顶点。这个 call 函数我们前面说过，这个 call 是用于将当前选择的元素传到 force.drag 函数中。最后，我们还需要一段代码，如下：
      force.on('tick', function () {
        svg_edges.attr('x1', function (d) {
          return d.source.x
        })
        svg_edges.attr('y1', function (d) {
          return d.source.y
        })
        svg_edges.attr('x2', function (d) {
          return d.target.x
        })
        svg_edges.attr('y2', function (d) {
          return d.target.y
        })

        svg_nodes.attr('cx', function (d) {
          return d.x
        })
        svg_nodes.attr('cy', function (d) {
          return d.y
        })
      })
    </script>
  </body>
</html>
